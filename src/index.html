<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Angular7Metronome</title>
  <base href="/">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" type="image/x-icon" href="favicon.ico">

  <!-- global css -->
  <link rel="stylesheet" href="./styles.css">

  <!-- Adobe fonts -->
  <link rel="stylesheet" href="https://use.typekit.net/uyb5fsi.css">
</head>
<body>
<div class="wrapper">
  <app-metronome class="app"></app-metronome>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/4.7.1/pixi.min.js"></script>
<script type="text/javascript">

  const config = {
      isTap: false,
      isSec01: false
  };

  //Create a Pixi Application
  let app = new PIXI.Application({
      width: 256,
      height: 256,
      backgroundColor: 0xffffff
  });

  app.renderer.view.style.position = "absolute";
  app.renderer.view.style.display = "block";
  app.renderer.autoResize = true;
  app.renderer.resize(window.innerWidth, window.innerHeight);
  app.renderer.backgroundColor = 0xffffff;

  /**
   * Button
   * @type {I18nInstructions.Text | ResponseContentType.Text | I18nUpdateOpCode.Text}
   */
  const button = new PIXI.Text('TAP');
  button.anchor.x   = 0.5;
  button.anchor.y   = 0.5;
  button.position.x = window.innerWidth * 0.5;
  button.position.y = window.innerHeight * 0.5;

  //ボタンをステージに追加
  app.stage.addChild(button);

  //タッチイベント(マウスイベント)を有効化
  button.interactive = true;

  // TOUCHイベント
  button.on('tap', () => config.isTap = true );

  // アニメーションの開始
  startAnimation();

  // Add the canvas that Pixi automatically created for you to the HTML document
  document.body.querySelector('.wrapper').appendChild(app.view);

  /**
   * Add Circle
   */
  const circle = new PIXI.Graphics();
  function addCircle () {
      circle.beginFill(0xDD0031);
      circle.drawCircle(0, 0, 1);

      circle.x = window.innerWidth / 2;
      circle.y = window.innerHeight / 2;
      app.stage.addChild(circle);

      return circle;
  }

  function fadeOut(item) {
      item.alpha -= 0.08;

      if (item.alpha < 0) {
          removeFromStage(item);
          config.isTap = false;
      }
  }

  /**
   * stageから特定の消す
   */
  function removeFromStage(param) {
      app.stage.removeChild(param);
  }

  /**
   * Start Ticker
   */
  function startAnimation() {
      app.ticker.add(delta => gameLoop(delta));
  }

  function scaleUp(item) {
      item.scale.x += 10;
      item.scale.y += 10;

      if (item.scale.y > 400) {
          config.isSec01 = false;
      }
  }

  /**
   * Loop
   */
  function gameLoop (delta) {

      if (config.isTap === true) {
          fadeOut(button);

          // ボタンが押されたら、sec01を発火
          if (config.isTap === false) {
              addCircle();
              config.isSec01 = true;
          }
      }

      if (config.isSec01 === true) {
          scaleUp(circle);
      }
  }
</script>
</body>
</html>
